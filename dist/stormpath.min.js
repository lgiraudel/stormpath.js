/*
 Stormpath.js v0.3.1
 (c) 2014 Stormpath, Inc. http://stormpath.com
 License: Apache 2.0
*/
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Stormpath=e()}}(function(){return function e(f,o,n){function d(t,l){if(!o[t]){if(!f[t]){var u="function"==typeof require&&require;if(!l&&u)return u(t,!0);if(i)return i(t,!0);throw new Error("Cannot find module '"+t+"'")}var p=o[t]={exports:{}};f[t][0].call(p.exports,function(e){var o=f[t][1][e];return d(o?o:e)},p,p.exports,e,f,o,n)}return o[t].exports}for(var i="function"==typeof require&&require,t=0;t<n.length;t++)d(n[t]);return d}({1:[function(e,f,o){"use strict";function n(e,f){var o="object"==typeof e?e:{},n="function"==typeof e?e:f||i.noop,l=this;if(l.jwt=o.token||l._getToken(),!l.jwt)return void setTimeout(function(){n(new Error("jwt not found as url query parameter"))},1);try{l.jwtPayload=JSON.parse(t.atob(l.jwt.split(".")[1])),l.appHref=l.jwtPayload.app_href,l.sptoken=l.jwtPayload.sp_token||null,l.baseurl=l.appHref.match("^.+//([^/]+)/")[0]}catch(u){return void setTimeout(function(){n(u)},1)}l.jwtPayload.onk&&l.setCachedOrganizationNameKey(l.jwtPayload.onk);var p=l.appHref;l.requestExecutor=o.requestExecutor||new d(l.jwt),l.requestExecutor.execute("GET",p+"?expand=idSiteModel",function(e,f){n(e,e?null:f.idSiteModel)})}var d=e("./request-executor"),i=e("./utils"),t=i.base64;n.prototype.organizationNameKeyCookieKey="sp.onk",n.prototype.organizationNameKeyCookieExpiration="expires=Fri, 31 Dec 9999 23:59:59 GMT",n.prototype.getCachedOrganizationNameKey=function(){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(this.organizationNameKeyCookieKey).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},n.prototype.setCachedOrganizationNameKey=function(e){document.cookie=encodeURIComponent(this.organizationNameKeyCookieKey)+"="+encodeURIComponent(e)+"; "+this.organizationNameKeyCookieExpiration},n.prototype._getToken=function(){return decodeURIComponent((window.location.href.match(/jwt=(.+)/)||[])[1]||"")},n.prototype.login=function(e,f){var o,n=this,d="object"==typeof e?e:null;if(!d)throw new Error("must provide an object");if(d.providerData)o=d;else{if(!d.login)throw new Error("unsupported credentials object");o={type:"basic",value:i.base64.btoa(d.login+":"+d.password)}}d.accountStore&&(o.accountStore=d.accountStore),n.requestExecutor.execute("POST",n.appHref+"/loginAttempts",{body:o,withCredentials:!0},f||i.noop)},n.prototype.register=function(e,f){if("object"!=typeof e)throw new Error("client.register() must be called with a data object");var o=this;o.requestExecutor.execute("POST",o.appHref+"/accounts",{body:e,withCredentials:!0},f||i.noop)},n.prototype.verifyEmailToken=function(e){if("function"!=typeof e)throw new Error("client.verifyEmailToken() takes a function as it's only argument");var f=this;f.requestExecutor.execute("POST",f.baseurl+"/v1/accounts/emailVerificationTokens/"+f.sptoken,e)},n.prototype.verifyPasswordResetToken=function(e){if("function"!=typeof e)throw new Error("client.verifyPasswordResetToken() takes a function as it's only argument");var f=this;f.requestExecutor.execute("GET",f.appHref+"/passwordResetTokens/"+f.sptoken,e)},n.prototype.setAccountPassword=function(e,f,o){if(!e||!e.href)throw new Error("invalid pwTokenVerification");if(!f)throw new Error("must supply new password as second argument to client.setAccountPassword()");var n=this;n.requestExecutor.execute("POST",e.href,{body:{password:f}},o||i.noop)},n.prototype.sendPasswordResetEmail=function(e,f){var o;if("string"==typeof e)o={email:e};else{if("object"!=typeof e)throw new Error("sendPasswordResetEmail must be called with an email/username as the first argument, or an options object");o=e}var n=this;n.requestExecutor.execute("POST",n.appHref+"/passwordResetTokens",{body:o},f||i.noop)},f.exports=n},{"./request-executor":3,"./utils":4}],2:[function(e,f,o){f.exports={Client:e("./client")}},{"./client":1}],3:[function(e,f,o){"use strict";function n(e,f,o,n){var d=this;return d.cb=n,d.options=o,d.xhr=new XMLHttpRequest,d.xhr.onreadystatechange=d.onLoad.bind(d),d.xhr.onerror=d.onerror.bind(d),d.xhr.open(e,f),o.withCredentials&&(d.xhr.withCredentials=o.withCredentials),d.xhr.setRequestHeader("Authorization","Bearer "+d.options.authToken),d.xhr.setRequestHeader("Content-Type","application/json"),d.xhr.send(JSON.stringify(o.body)),d.done=!1,d}function d(e){this.authToken=e,this.terminated=!1}var i=e("./utils");n.prototype.onLoad=function(){var e=this,f=XMLHttpRequest,o=e.xhr.readyState;if(o===f.DONE&&!e.done)try{var n=e.responseHeaders=e.getHeadersObject(),d="string"==typeof e.xhr.responseText&&""!==e.xhr.responseText?JSON.parse(e.xhr.responseText):{},i=e.xhr.status,t=((n.Authorization||"").match(/Bearer (.*)$/i)||[])[1]||"";e.cb(400>i?null:d,t,e,400>i?d:null),e.done=!0}catch(l){e.cb(l)}},n.prototype.onerror=function(){var e=this;e.done=!0,e.cb(new Error("Unknown XHR Error"))},n.prototype.getHeadersObject=function(){var e=this,f=e.xhr.getAllResponseHeaders().trim().split("\n");return f.reduce(function(e,f){var o=f.split(": ");return o.length>1&&(e[o[0]]=o[1].trim()),e},{})},d.prototype.execute=function(e,f,o,d){var t=this;if(t.terminated)return d(new Error("Request executor terminated, you must initiate a new flow from the service provider"));var l="object"==typeof o?o:{body:null};l.authToken=t.authToken;var u="function"==typeof o?o:d||i.noop,p=new n(e,f,l,function(e,f,o,n){var d=o&&o.responseHeaders&&o.responseHeaders["Stormpath-SSO-Redirect-Location"];return t.authToken=f,e||t.authToken||(t.terminated=!0),e?(d&&(e.redirectUrl=d),u(e)):(d&&(n.redirectUrl=d),void u(e,n))});return p},f.exports=d},{"./utils":4}],4:[function(e,f,o){"use strict";function n(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,f){return String.fromCharCode("0x"+f)}))}f.exports={base64:{atob:function(e){return decodeURIComponent(window.atob(e))},btoa:function(e){var f=n(e);return f}},noop:function(){}}},{}]},{},[2])(2)});